webpackJsonp([29],{LlFv:function(t,e,i){"use strict";var s=i("IHPB"),l=i.n(s),a=i("rVsN"),o=i.n(a),d=i("ELdc"),r=i("C6mD");e.a={props:{reloadList:Function},data:function(){return{listSelectedRow:{},listSelectedRowIndex:-1,listSkeleton:!0,listLoading:!1,listRows:[],listRowDeleteLoading$:"delete_loading$",listShowAdd:!1,listAddLoading:!1,listShowEdit:!1,listEditLoading:!1}},methods:{formatterListRow:function(t){return t[this.listRowDeleteLoading$]=!1,t},formatterListRows:function(t){var e=this,i=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).formatterRow;return t.forEach(function(t){e.formatterListRow(t),i&&i(t)}),t},reloadListRows:function(t){var e=this,i=t.formatterRow;Object(r.f)(this.reloadList)&&(this.listLoading=!0,new o.a(this.reloadList).then(function(t){e.listLoading=!1,e.listSkeleton=!1,e.listRows=e.formatterListRows(t,{formatterRow:i})}).catch(function(t){e.listLoading=!1,e.listSkeleton=500}))},appendListRow:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).formatterCell;this.listRows.push(this.formatterListRow(t,{formatterCell:e}))},appendListRows:function(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=i.formatterRow,a=i.formatterCell;(e=this.listRows).push.apply(e,l()(this.formatterListRows(t,{formatterRow:s,formatterCell:a})))},removeListRow:function(t){if(t)for(var e=0;e<this.listRows.length;e++)if(t===this.listRows[e])return void this.listRows.splice(e,1)},removeListRows:function(t){if(t&&0!==t.length)for(var e=0;e<this.listRows.length;e++)for(var i in t)if(t[i]===this.listRows[e]){this.listRows.splice(e,1),e--;break}},handleListShowEdit:function(t){var e=t.row,i=t.$index;this.listSelectedRow=e,this.listSelectedRowIndex=i,Object(d.a)(this.listEditForm,e),this.listShowEdit=!0}}}},h79M:function(t,e){},oDnw:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("qSEq"),l=i("pnBm"),a=i("LlFv"),o=i("Nj3f"),d={get:{moduleByModuleId:o.a+"/api-gar-module/get/moduleByModuleId/{moduleId}",validateModuleIdCanUse:o.a+"/api-gar-module/get/validateModuleIdCanUse/{moduleId}",validatePathCanUse:o.a+"/api-gar-module/get/validatePathCanUse/{path}",validateServiceIdCanUse:o.a+"/api-gar-module/get/validateServiceIdCanUse/{serviceId}",listModule:o.a+"/api-gar-module/get/list/module"},post:{module:o.a+"/api-gar-module/post/module"},put:{moduleByModuleId:o.a+"/api-gar-module/put/moduleByModuleId/{moduleId}"},delete:{moduleByModuleId:o.a+"/api-gar-module/delete/moduleByModuleId/{moduleId}"}},r=i("ELdc"),n=s.b.data(),c={id:"",serviceName:"",status:""},u={name:"module-manage",mixins:[s.b,l.a,a.a],data:function(){var t=this;return{serviceIdSuffix:"-service",pathPrefix:"/api-",pathSuffix:"/**",listAddForm:Object(r.a)({},c,{status:n.dict.statusValue.NORMAL}),listAddFormRules:{id:[{required:!0,message:"请输入模块ID",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"},{validator:function(e,i,s){/^[a-zA-Z]+$/.test(i)?t.$Ajax.get(d.get.validateModuleIdCanUse,[i]).success(!0,function(t){t.records.canUse?s():s(new Error("模块ID不可用"))}).fail(!0,function(t){s(new Error(t.resultInfo.message))}).catch(function(){s(new Error("发生错误...请稍后再试"))}):s(new Error("模块ID格式不正确"))},trigger:"blur"}],serviceName:[{required:!0,message:"请输入模块名称",trigger:"blur"}]},listEditForm:Object(r.a)({},c,{moduleId:""}),listEditFormRules:{id:[{required:!0,message:"请输入模块ID",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"},{validator:function(e,i,s){/^[a-zA-Z]+$/.test(i)?t.$Ajax.get(d.get.validateModuleIdCanUse,[i],{params:{excludeModuleIds:[t.listEditForm.moduleId].toString()}}).success(!0,function(t){t.records.canUse?s():s(new Error("模块ID不可用"))}).fail(!0,function(t){s(new Error(t.resultInfo.message))}).catch(function(){s(new Error("发生错误...请稍后再试"))}):s(new Error("模块ID格式不正确"))},trigger:"blur"}],serviceName:[{required:!0,message:"请输入模块名称",trigger:"blur"}]}}},methods:{resetForm:function(t){this.$refs[t].resetFields()},getRows:function(){var t=this;this.listLoading=!0,this.$Ajax.get(d.get.listModule).success(!0,function(e){t.listRows=t.formatterListRows(e.rows),t.listSkeleton=!1}).notSuccess(function(){return t.listSkeleton=500}).catch(function(){return t.listSkeleton=500}).finally(function(){return t.listLoading=!1})},handleClickListAdd:function(t,e){var i=this;this.$refs.listAddForm.validate(function(t){if(!t)return!1;var s=Object(r.a)({path:""+i.pathPrefix+i.listAddForm.id+i.pathSuffix,serviceId:""+i.listAddForm.id+i.serviceIdSuffix},i.listAddForm);i.listAddLoading=!0,i.$Ajax.post(d.post.module,s).success("创建模块成功",function(){e.close(),i.resetForm("listAddForm"),i.getRows()}).finally(function(){return i.listAddLoading=!1})})},handleListShowEdit:function(t){var e=t.row,i=t.$index;this.listSelectedRow=e,this.listSelectedRowIndex=i,Object(r.a)(this.listEditForm,e,{moduleId:e.id}),this.listShowEdit=!0},handleClickListEdit:function(t,e){var i=this;this.$refs.listEditForm.validate(function(t){if(!t)return!1;var s=Object(r.a)({moduleId:i.listSelectedRow.id,path:""+i.pathPrefix+i.listEditForm.id+i.pathSuffix,serviceId:""+i.listEditForm.id+i.serviceIdSuffix},i.listEditForm);i.listEditLoading=!0,i.$Ajax.put(d.put.moduleByModuleId,s).success("修改模块成功",function(){e.close(),Object(r.a)(i.listSelectedRow,s),i.resetForm("listEditForm")}).finally(function(){return i.listEditLoading=!1})})},handleClickDeleteRow:function(t){var e=this,i=t.row,s=t.$index,l=(t.event,t.vm);i[this.listRowDeleteLoading$]=!0,this.$Ajax.delete(d.delete.moduleByModuleId,{moduleId:i.id}).success("删除成功",function(){e.listRows.splice(s,1),l.close()}).finally(function(){return i[e.listRowDeleteLoading$]=!1})}},created:function(){this.getRows()}},m={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"avalon-merlin-default-main-content avalon-merlin-v-scroll",staticStyle:{"background-color":"#F9F9F9"}},[i("div",{staticClass:"module-list-main"},[i("we-skeleton",{attrs:{animation:"","paragraph-rows":10,"title-width":"50%","paragraph-width":"100%"},on:{reload:t.getRows},model:{value:t.listSkeleton,callback:function(e){t.listSkeleton=e},expression:"listSkeleton"}},[i("ul",{staticClass:"module-list"},[t._l(t.listRows,function(e,s){return i("li",[i("div",{staticClass:"module-tools"},[i("div",{staticClass:"tools-left"},["gar-service"!==e.serviceId?i("i",{staticClass:"el-icon-edit",on:{click:function(i){t.handleListShowEdit({row:e,$index:s})}}}):t._e(),t._v(" "),t._e()]),t._v(" "),"gar-service"!==e.serviceId?i("div",{staticClass:"tools-right"},[i("we-popover",{attrs:{title:"操作",type:"confirm",placement:"top-start",manual:e[t.listRowDeleteLoading$],"confirm-button-text":"删了吧","cancel-button-text":e[t.listRowDeleteLoading$]?"你没有想的机会了":"我再想想","cancel-button-options":{disabled:e[t.listRowDeleteLoading$]},"confirm-button-options":{loading:e[t.listRowDeleteLoading$]}},on:{"click-cancel-button":function(t,e){return e.close()},"click-confirm-button":function(i,l){return t.handleClickDeleteRow({row:e,$index:s,event:i,vm:l})}}},[i("template",{slot:"content"},[e[t.listRowDeleteLoading$]?[i("span",{staticStyle:{color:"red"}},[t._v("删除中...")]),t._v("删除完成后将自动关闭气泡\n                  ")]:[t._v("\n                    您确定要"),i("span",{staticStyle:{color:"red"}},[t._v("删除")]),t._v("该模块及其"),i("span",{staticStyle:{color:"red"}},[t._v("相关数据")]),t._v("吗？\n                    "),i("div",{staticStyle:{color:"red"}},[t._v("删除后不可恢复！！！")])]],2),t._v(" "),i("i",{staticClass:"el-icon-delete"})],2)],1):t._e()]),t._v(" "),i("div",{staticClass:"module-one",on:{click:function(i){t.openResourceManage(e.id)}}},[i("ul",{staticClass:"module-info-form"},[i("li",[i("em",{staticClass:"info-title tar"},[t._v("模块ID：")]),t._v(" "),i("div",{staticClass:"info-content ellipsis"},[t._v(t._s(e.id))])]),t._v(" "),i("li",[i("em",{staticClass:"info-title tar"},[t._v("服务ID：")]),t._v(" "),i("div",{staticClass:"info-content ellipsis"},[t._v(t._s(e.serviceId))])]),t._v(" "),i("li",[i("em",{staticClass:"info-title tar"},[t._v("服务名：")]),t._v(" "),i("div",{staticClass:"info-content ellipsis"},[t._v(t._s(e.serviceName))])]),t._v(" "),i("li",[i("em",{staticClass:"info-title tar"},[t._v("路由地址：")]),t._v(" "),i("div",{staticClass:"info-content ellipsis"},[t._v(t._s(e.path))])]),t._v(" "),i("li",[i("em",{staticClass:"info-title tar"},[t._v("状态：")]),t._v(" "),i("div",{staticClass:"info-content ellipsis"},[i("em",{directives:[{name:"show",rawName:"v-show",value:e.status===t.dict.statusValue.NORMAL,expression:"row.status === dict.statusValue.NORMAL"}],staticClass:"fc-normal"},[t._v("正常")]),t._v(" "),i("em",{directives:[{name:"show",rawName:"v-show",value:e.status===t.dict.statusValue.DISABLED,expression:"row.status === dict.statusValue.DISABLED"}],staticClass:"fc-disable"},[t._v("禁用")])])])])])])}),t._v(" "),i("li",{on:{click:function(e){t.listShowAdd=!0}}},[i("div",{staticClass:"module-one"},[i("i",{staticClass:"module-add-btn el-icon-plus"})])])],2)]),t._v(" "),i("we-layer",{attrs:{title:"新建模块",width:500,height:460,position:"center",drag:"","confirm-button-options":{loading:t.listAddLoading}},on:{"click-confirm-button":t.handleClickListAdd},model:{value:t.listShowAdd,callback:function(e){t.listShowAdd=e},expression:"listShowAdd"}},[i("div",{staticClass:"form-padding"},[i("el-form",{ref:"listAddForm",attrs:{"label-width":"90px",model:t.listAddForm,rules:t.listAddFormRules}},[i("el-form-item",{attrs:{label:"模块ID:",prop:"id"}},[i("el-input",{staticStyle:{width:"70%"},attrs:{label:"right"},model:{value:t.listAddForm.id,callback:function(e){t.$set(t.listAddForm,"id",e)},expression:"listAddForm.id"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"服务ID:",prop:"serviceId"}},[i("el-input",{staticStyle:{width:"70%"},attrs:{label:"right",disabled:""},model:{value:t.listAddForm.id,callback:function(e){t.$set(t.listAddForm,"id",e)},expression:"listAddForm.id"}}),t._v(" "),i("el-input",{staticStyle:{width:"24%"},attrs:{label:"right",disabled:""},model:{value:t.serviceIdSuffix,callback:function(e){t.serviceIdSuffix=e},expression:"serviceIdSuffix"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"服务名称:",prop:"serviceName"}},[i("el-input",{staticStyle:{width:"95%"},attrs:{label:"right"},model:{value:t.listAddForm.serviceName,callback:function(e){t.$set(t.listAddForm,"serviceName",e)},expression:"listAddForm.serviceName"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"根路径:",prop:"path"}},[i("el-input",{staticStyle:{width:"24%"},attrs:{label:"right",disabled:""},model:{value:t.pathPrefix,callback:function(e){t.pathPrefix=e},expression:"pathPrefix"}}),t._v(" "),i("el-input",{staticStyle:{width:"45%"},attrs:{label:"right",disabled:""},model:{value:t.listAddForm.id,callback:function(e){t.$set(t.listAddForm,"id",e)},expression:"listAddForm.id"}}),t._v(" "),i("el-input",{staticStyle:{width:"24%"},attrs:{label:"right",disabled:""},model:{value:t.pathSuffix,callback:function(e){t.pathSuffix=e},expression:"pathSuffix"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"状态:"}},[i("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#cccccc","active-value":t.dict.statusValue.NORMAL,"inactive-value":t.dict.statusValue.DISABLED},model:{value:t.listAddForm.status,callback:function(e){t.$set(t.listAddForm,"status",e)},expression:"listAddForm.status"}})],1)],1)],1)]),t._v(" "),i("we-layer",{attrs:{title:"编辑模块",width:500,height:460,position:"center",drag:"","confirm-button-options":{loading:t.listEditLoading}},on:{"click-confirm-button":t.handleClickListEdit},model:{value:t.listShowEdit,callback:function(e){t.listShowEdit=e},expression:"listShowEdit"}},[i("div",{staticClass:"form-padding"},[i("el-form",{ref:"listEditForm",attrs:{"label-width":"90px",model:t.listEditForm,rules:t.listEditFormRules}},[i("el-form-item",{attrs:{label:"模块ID:",prop:"id"}},[i("el-input",{staticStyle:{width:"70%"},attrs:{label:"right",disabled:""},model:{value:t.listEditForm.id,callback:function(e){t.$set(t.listEditForm,"id",e)},expression:"listEditForm.id"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"服务ID:",prop:"serviceId"}},[i("el-input",{staticStyle:{width:"70%"},attrs:{label:"right",disabled:""},model:{value:t.listEditForm.id,callback:function(e){t.$set(t.listEditForm,"id",e)},expression:"listEditForm.id"}}),t._v(" "),i("el-input",{staticStyle:{width:"24%"},attrs:{label:"right",disabled:""},model:{value:t.serviceIdSuffix,callback:function(e){t.serviceIdSuffix=e},expression:"serviceIdSuffix"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"服务名称:",prop:"serviceName"}},[i("el-input",{staticStyle:{width:"95%"},attrs:{label:"right"},model:{value:t.listEditForm.serviceName,callback:function(e){t.$set(t.listEditForm,"serviceName",e)},expression:"listEditForm.serviceName"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"根路径:",prop:"path"}},[i("el-input",{staticStyle:{width:"24%"},attrs:{label:"right",disabled:""},model:{value:t.pathPrefix,callback:function(e){t.pathPrefix=e},expression:"pathPrefix"}}),t._v(" "),i("el-input",{staticStyle:{width:"45%"},attrs:{label:"right",disabled:""},model:{value:t.listEditForm.id,callback:function(e){t.$set(t.listEditForm,"id",e)},expression:"listEditForm.id"}}),t._v(" "),i("el-input",{staticStyle:{width:"24%"},attrs:{label:"right",disabled:""},model:{value:t.pathSuffix,callback:function(e){t.pathSuffix=e},expression:"pathSuffix"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"状态:"}},[i("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#cccccc","active-value":t.dict.statusValue.NORMAL,"inactive-value":t.dict.statusValue.DISABLED},model:{value:t.listEditForm.status,callback:function(e){t.$set(t.listEditForm,"status",e)},expression:"listEditForm.status"}})],1)],1)],1)])],1)])},staticRenderFns:[]};var f=i("C7Lr")(u,m,!1,function(t){i("h79M")},"data-v-02197ff9",null);e.default=f.exports}});