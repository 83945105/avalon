webpackJsonp([7],{"+pQH":function(e,t,r){var o=r("273z");o(o.P+o.R,"Map",{toJSON:r("R+mD")("Map")})},"4qZx":function(e,t,r){var o=r("ih9o");e.exports=function(e,t){if(!o(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},CVdf:function(e,t,r){var o=r("GEwK"),n=r("bPMW"),s=r("6Ke0"),i=r("WA9S"),c=r("GO8T");e.exports=function(e,t){var r=1==e,a=2==e,d=3==e,l=4==e,u=6==e,h=5==e||u,f=t||c;return function(t,c,p){for(var v,g,R=s(t),x=n(R),y=o(c,p,3),I=i(x.length),T=0,_=r?f(t,I):a?f(t,0):void 0;I>T;T++)if((h||T in x)&&(g=y(v=x[T],T,R),e))if(r)_[T]=g;else if(g)switch(e){case 3:return!0;case 5:return v;case 6:return T;case 2:_.push(v)}else if(l)return!1;return u?-1:d||l?l:_}}},GO8T:function(e,t,r){var o=r("oeSC");e.exports=function(e,t){return new(o(e))(t)}},HzJ8:function(e,t,r){e.exports={default:r("UCoN"),__esModule:!0}},Kdj8:function(e,t,r){"use strict";var o=r("HH4H"),n=r("273z"),s=r("92Lf"),i=r("QzFD"),c=r("Rb18"),a=r("SFw5"),d=r("EWZD"),l=r("6Iqy"),u=r("ih9o"),h=r("bNZV"),f=r("VKnT").f,p=r("CVdf")(0),v=r("5D1g");e.exports=function(e,t,r,g,R,x){var y=o[e],I=y,T=R?"set":"add",_=I&&I.prototype,C={};return v&&"function"==typeof I&&(x||_.forEach&&!i(function(){(new I).entries().next()}))?(I=t(function(t,r){l(t,I,e,"_c"),t._c=new y,void 0!=r&&d(r,R,t[T],t)}),p("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(e){var t="add"==e||"set"==e;e in _&&(!x||"clear"!=e)&&c(I.prototype,e,function(r,o){if(l(this,I,e),!t&&x&&!u(r))return"get"==e&&void 0;var n=this._c[e](0===r?0:r,o);return t?this:n})}),x||f(I.prototype,"size",{get:function(){return this._c.size}})):(I=g.getConstructor(t,e,R,T),a(I.prototype,r),s.NEED=!0),h(I,e),C[e]=I,n(n.G+n.W+n.F,C),x||g.setStrong(I,e,R),I}},NnAP:function(e,t,r){var o=r("6Bon"),n=r("MGMR");e.exports=r("UB+n").getIterator=function(e){var t=n(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return o(t.call(e))}},OKrO:function(e,t,r){r("uT9G")("Map")},"R+mD":function(e,t,r){var o=r("jUE6"),n=r("c5rS");e.exports=function(e){return function(){if(o(this)!=e)throw TypeError(e+"#toJSON isn't generic");return n(this)}}},UCoN:function(e,t,r){r("xsjh"),r("zRHv"),e.exports=r("NnAP")},aUxz:function(e,t,r){"use strict";var o=r("273z"),n=r("HeGE"),s=r("GEwK"),i=r("EWZD");e.exports=function(e){o(o.S,e,{from:function(e){var t,r,o,c,a=arguments[1];return n(this),(t=void 0!==a)&&n(a),void 0==e?new this:(r=[],t?(o=0,c=s(a,arguments[2],2),i(e,!1,function(e){r.push(c(e,o++))})):i(e,!1,r.push,r),new this(r))}})}},c5rS:function(e,t,r){var o=r("EWZD");e.exports=function(e,t){var r=[];return o(e,!1,r.push,r,t),r}},cUn4:function(e,t,r){e.exports={default:r("p0nO"),__esModule:!0}},g12w:function(e,t,r){"use strict";var o=r("w12C"),n=r("4qZx");e.exports=r("Kdj8")("Map",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=o.getEntry(n(this,"Map"),e);return t&&t.v},set:function(e,t){return o.def(n(this,"Map"),0===e?0:e,t)}},o,!0)},oeSC:function(e,t,r){var o=r("ih9o"),n=r("f5Gq"),s=r("mhb3")("species");e.exports=function(e){var t;return n(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!n(t.prototype)||(t=void 0),o(t)&&null===(t=t[s])&&(t=void 0)),void 0===t?Array:t}},p0nO:function(e,t,r){r("VE3R"),r("zRHv"),r("xsjh"),r("g12w"),r("+pQH"),r("OKrO"),r("tOwx"),e.exports=r("UB+n").Map},pFvh:function(e,t){},tOwx:function(e,t,r){r("aUxz")("Map")},uT9G:function(e,t,r){"use strict";var o=r("273z");e.exports=function(e){o(o.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},vqdg:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("cUn4"),n=r.n(o),s=r("HzJ8"),i=r.n(s),c=r("aA9S"),a=r.n(c),d=r("qSEq"),l=d.b.data(),u={currentPage:1,pageCount:1,pageSize:10,total:0},h={name:"role-resource-manage",mixins:[d.b],data:function(){return{tableHeight:0,roleResourceList:[],searchType:l.dict.searchTypes[0].value,searchResourceTreeLoading:!1,searchResourceTree:{searchTreeText:""},searchLocationResource:"",searchLocationExpandIds:[],searchResourceTreeList:[],resourceList:[],limit:a()({},u),searchResource:{searchText:""},searchResourceTreeModel:!1}},props:{moduleId:{type:String,required:!0},roleId:{type:String,required:!0},role:{type:String,required:!0},roleName:{type:String,required:!0}},computed:{treeTopNum:function(){return this.searchResourceTreeList.length>0?113:62},searchResourceTreeRootIds:function(){var e=[],t=!0,r=!1,o=void 0;try{for(var n,s=i()(this.searchResourceTreeList);!(t=(n=s.next()).done);t=!0){var c=n.value;e.push(c.id)}}catch(e){r=!0,o=e}finally{try{!t&&s.return&&s.return()}finally{if(r)throw o}}return e},hasResourceIdsMap:function(){var e=new n.a,t=!0,r=!1,o=void 0;try{for(var s,c=i()(this.roleResourceList);!(t=(s=c.next()).done);t=!0){var a=s.value;e.set(a.resId,!0)}}catch(e){r=!0,o=e}finally{try{!t&&c.return&&c.return()}finally{if(r)throw o}}return e}},methods:{getRoleResourceListByRoleId:function(){var e=this;this.$Ajax.get(RoleResourceManagerUrl.get.roleResourceListByRoleId,{moduleId:this.moduleId,roleId:this.roleId}).success(!0,function(t){e.roleResourceList=t.rows})},searchResourceTreeListProcess:function(e){var t=this,r=[],o=this.hasResourceIdsMap;return e.forEach(function(e){e.children=e.children?e.children:[],e.leaf=!e.childCount||0===e.childCount.length,e.disabled=!e.status||e.status===t.dict.status.disabled||"NODE"!==e.type,e.checked=!!o.get(e.id),e.grantNodeChildLoading=!1,e.unGrantNodeChildLoading=!1,e.grantNodeAllChildLoading=!1,e.unGrantNodeAllChildLoading=!1,r.push(e)}),r},formatterResourceType:function(e,t,r,o){for(var n in this.dict.resourceTypes)if(this.dict.resourceTypes[n].value===r)return this.dict.resourceTypes[n].text;return"未知"},handleSizeChange:function(e){this.limit.pageSize=e,this.getResourcePageList()},handleCurrentChange:function(e){this.limit.currentPage=e,this.getResourcePageList()},getSearchResourceTreeList:function(){var e=this;this.searchResourceTreeLoading=!0,this.$Ajax.get(ResourceManagerUrl.get.rootResourceList,{moduleId:this.moduleId,searchText:this.searchResourceTree.searchTreeText}).success(!0,function(t){e.searchResourceTreeList=e.searchResourceTreeListProcess(t.rows)}).finally(function(){return e.searchResourceTreeLoading=!1})},handleLocationSearchResourceTree:function(e,t){e?this.$Ajax.get(ResourceManagerUrl.get.locationResourceList,{moduleId:this.moduleId,rootIds:this.searchResourceTreeRootIds.toString(),searchText:e}).success(!0,function(e){t(e.rows)}):t([])},handleSelectLocationSearchResource:function(e){this.searchLocationExpandIds=e.parentIds.substring(1).split("/"),this.expandSearchResourceNode()},expandSearchResourceNode:function(){var e=this.$refs.searchResourceTree.getNode(this.searchLocationExpandIds[0]);e&&(this.searchLocationExpandIds=this.searchLocationExpandIds.slice(1),!1===e.expanded?(e.expand(),this.expandSearchResourceNode()):this.expandSearchResourceNode())},getSearchResourceTreeChildNodeList:function(e,t){var r=this;this.$Ajax.get(ResourceManagerUrl.get.childResourceList,{moduleId:this.moduleId,parentId:e.data.id}).success(!0,function(o){var n=r.searchResourceTreeListProcess(o.rows);if(e.data.children=n,e.data.childCount=n.length,e.data.open=!0,t(n),r.searchLocationExpandIds&&r.searchLocationExpandIds.length>0){var s=r.$refs.searchResourceTree.getNode(r.searchLocationExpandIds[0]);r.searchLocationExpandIds=r.searchLocationExpandIds.slice(1),s&&!1===s.expanded&&s.expand()}if(r.newLocationExpandIds&&r.newLocationExpandIds.length>0){var i=r.$refs.newResourceTree.getNode(r.newLocationExpandIds[0]);r.newLocationExpandIds=r.newLocationExpandIds.slice(1),i&&!1===i.expanded&&i.expand()}})},handleCheckedSearchResourceTreeNode:function(e,t,r){var o=this;r?this.$Ajax.post(RoleResourceManagerUrl.post.grantResourceToRole,{moduleId:this.moduleId,roleId:this.roleId,resourceId:t.id}).success(!0,function(){t.checked=!0,o.hasResourceIdsMap.set(t.id,!0)}):this.$Ajax.post(RoleResourceManagerUrl.post.unGrantResourceToRole,{moduleId:this.moduleId,roleId:this.roleId,resourceId:t.id}).success(!0,function(){t.checked=!1,o.hasResourceIdsMap.delete(t.id)})},handleDblClickTreeNode:function(e,t){t.childCount>0&&(e.expanded?e.collapse():e.expand())},handleClickGrantResourcesInNodeToRole:function(e,t){var r=this;t.grantNodeChildLoading=!0,this.$Ajax.post(RoleResourceManagerUrl.post.grantResourcesInNodeToRole,{moduleId:this.moduleId,nodeId:t.id,roleId:this.roleId}).success(!0,function(e){t.children&&t.children.forEach(function(e){return e.checked=!0}),e.rows.forEach(function(e){r.hasResourceIdsMap.set(e,!0)})}).finally(function(){return t.grantNodeChildLoading=!1})},handleClickUnGrantResourcesInNodeToRole:function(e,t){var r=this;t.unGrantNodeChildLoading=!0,this.$Ajax.post(RoleResourceManagerUrl.post.unGrantResourcesInNodeToRole,{moduleId:this.moduleId,nodeId:t.id,roleId:this.roleId}).success(!0,function(e){t.children&&t.children.forEach(function(e){return e.checked=!1}),e.rows.forEach(function(e){r.hasResourceIdsMap.delete(e)})}).finally(function(){return t.unGrantNodeChildLoading=!1})},checkedChildNode:function(e){var t=!0,r=!1,o=void 0;try{for(var n,s=i()(e);!(t=(n=s.next()).done);t=!0){var c=n.value;c.checked=!0,c.children&&this.checkedChildNode(c.children)}}catch(e){r=!0,o=e}finally{try{!t&&s.return&&s.return()}finally{if(r)throw o}}},handleClickGrantAllChildResourcesInNode:function(e,t){var r=this;t.grantNodeAllChildLoading=!0,this.$Ajax.post(RoleResourceManagerUrl.post.grantAllChildResourcesInNodeToRole,{moduleId:this.moduleId,nodeId:t.id,roleId:this.roleId}).success(!0,function(e){t.children&&r.checkedChildNode(t.children),e.rows.forEach(function(e){r.hasResourceIdsMap.set(e,!0)})}).finally(function(){return t.grantNodeAllChildLoading=!1})},unCheckedChildNode:function(e){var t=!0,r=!1,o=void 0;try{for(var n,s=i()(e);!(t=(n=s.next()).done);t=!0){var c=n.value;c.checked=!1,c.children&&this.unCheckedChildNode(c.children)}}catch(e){r=!0,o=e}finally{try{!t&&s.return&&s.return()}finally{if(r)throw o}}},handleClickUnGrantAllChildResourcesInNode:function(e,t){var r=this;t.unGrantNodeAllChildLoading=!0,this.$Ajax.post(RoleResourceManagerUrl.post.unGrantAllChildResourcesInNodeToRole,{moduleId:this.moduleId,nodeId:t.id,roleId:this.roleId}).success(!0,function(e){t.children&&r.unCheckedChildNode(t.children),e.rows.forEach(function(e){r.hasResourceIdsMap.delete(e)})}).finally(function(){return t.unGrantNodeAllChildLoading=!1})}},created:function(){this.getRoleResourceListByRoleId()},mounted:function(){this.tableHeight=document.body.clientHeight-220}},f={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{staticClass:"avalon-merlin-default-search-bar full avalon-merlin-a-scroll"},[r("el-input",{staticStyle:{width:"200px"},attrs:{size:"small",clearable:"",placeholder:"请输入内容","prefix-icon":"el-icon-search"},model:{value:e.searchResourceTree.searchTreeText,callback:function(t){e.$set(e.searchResourceTree,"searchTreeText",t)},expression:"searchResourceTree.searchTreeText"}}),e._v(" "),r("span",{staticClass:"btn-p-left"},[r("el-button",{attrs:{type:"success",size:"small",loading:e.searchResourceTreeLoading},on:{click:e.getSearchResourceTreeList}},[e._v("根节点搜索")])],1)],1),e._v(" "),r("div",{staticStyle:{"margin-top":"15px"},style:{height:e.tableHeight+"px"}},[e.searchResourceTreeList.length>0?r("div",{staticClass:"list-tools avalon-merlin-hidden"},[r("div",{staticClass:"avalon-merlin-lfloat"},[r("el-tag",{attrs:{size:"small"}},[e._v("双击节点名称可以展开/收缩节点")])],1),e._v(" "),r("div",{staticClass:"avalon-merlin-lfloat",staticStyle:{"margin-left":"10px"}},[r("el-tag",{attrs:{size:"small"}},[e._v("点击鼠标右键开启快捷菜单(未实现)")])],1),e._v(" "),r("div",{staticClass:"avalon-merlin-lfloat",staticStyle:{"margin-left":"10px"}},[r("el-tag",{attrs:{size:"small"}},[e._v("勾选复选框启用资源")])],1)]):e._e(),e._v(" "),r("div",{staticClass:"tree-module",style:{top:e.treeTopNum+"px"}},[r("el-autocomplete",{directives:[{name:"show",rawName:"v-show",value:e.searchResourceTreeList.length>0,expression:"searchResourceTreeList.length > 0"}],staticStyle:{width:"40%"},attrs:{size:"small",placeholder:"资源定位",debounce:1e3,"value-key":"locationName","fetch-suggestions":e.handleLocationSearchResourceTree,"prefix-icon":"el-icon-search"},on:{select:e.handleSelectLocationSearchResource},model:{value:e.searchLocationResource,callback:function(t){e.searchLocationResource=t},expression:"searchLocationResource"}}),e._v(" "),r("div",{staticClass:"tree-module-inner avalon-merlin-v-scroll"},[r("el-tree",{ref:"searchResourceTree",attrs:{data:e.searchResourceTreeList,"highlight-current":!0,draggable:!0,"check-strictly":!0,lazy:"","expand-on-click-node":!1,props:{label:"name",isLeaf:"leaf"},load:e.getSearchResourceTreeChildNodeList,"node-key":"id","empty-text":"暂无资源"},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.node,n=t.data;return r("span",{staticClass:"custom-tree-node"},[r("span",["NODE"!==n.type?r("el-checkbox",{attrs:{value:n.checked},on:{change:function(t){e.handleCheckedSearchResourceTreeNode(o,n,t)}}}):e._e(),e._v(" "),o.expanded||n.type!==e.dict.resourceType.node?o.expanded&&n.type===e.dict.resourceType.node?r("i",{staticClass:"we-icon-folder-open-o"}):n.type===e.dict.resourceType.url?r("i",{staticClass:"we-icon-link"}):n.type===e.dict.resourceType.permission?r("i",{staticClass:"we-icon-jurisdiction-shield"}):e._e():r("i",{staticClass:"we-icon-folder-o"}),e._v(" "),r("em",{on:{dblclick:function(t){e.handleDblClickTreeNode(o,n)}}},[e._v(e._s(o.label))])],1),e._v(" "),"NODE"===n.type&&n.childCount>0?r("span",[r("el-button",{staticStyle:{color:"#409eff"},attrs:{loading:n.grantNodeChildLoading,type:"text",size:"mini"},on:{click:function(t){t.stopPropagation(),e.handleClickGrantResourcesInNodeToRole(o,n)}}},[e._v("使用该节点下所有资源")]),e._v(" "),r("em",[e._v("/")]),e._v(" "),r("el-button",{staticStyle:{color:"#409eff"},attrs:{loading:n.unGrantNodeChildLoading,type:"text",size:"mini"},on:{click:function(t){t.stopPropagation(),e.handleClickUnGrantResourcesInNodeToRole(o,n)}}},[e._v("取消该节点下所有资源")]),e._v(" "),r("em",[e._v("    ")]),e._v(" "),r("el-button",{staticStyle:{color:"#f56c6c"},attrs:{loading:n.grantNodeAllChildLoading,type:"text",size:"mini"},on:{click:function(t){t.stopPropagation(),e.handleClickGrantAllChildResourcesInNode(o,n)}}},[e._v("使用该节点及所有子节点下所有资源")]),e._v(" "),r("em",[e._v("/")]),e._v(" "),r("el-button",{staticStyle:{color:"#f56c6c"},attrs:{loading:n.unGrantNodeAllChildLoading,type:"text",size:"mini"},on:{click:function(t){t.stopPropagation(),e.handleClickUnGrantAllChildResourcesInNode(o,n)}}},[e._v("取消该节点及所有子节点下所有资源")])],1):e._e()])}}])})],1)],1)])])},staticRenderFns:[]};var p=r("C7Lr")(h,f,!1,function(e){r("pFvh")},"data-v-5d7712b7",null);t.default=p.exports},w12C:function(e,t,r){"use strict";var o=r("VKnT").f,n=r("hX+v"),s=r("SFw5"),i=r("GEwK"),c=r("6Iqy"),a=r("EWZD"),d=r("sswn"),l=r("UFff"),u=r("//tU"),h=r("5D1g"),f=r("92Lf").fastKey,p=r("4qZx"),v=h?"_s":"size",g=function(e,t){var r,o=f(t);if("F"!==o)return e._i[o];for(r=e._f;r;r=r.n)if(r.k==t)return r};e.exports={getConstructor:function(e,t,r,d){var l=e(function(e,o){c(e,l,t,"_i"),e._t=t,e._i=n(null),e._f=void 0,e._l=void 0,e[v]=0,void 0!=o&&a(o,r,e[d],e)});return s(l.prototype,{clear:function(){for(var e=p(this,t),r=e._i,o=e._f;o;o=o.n)o.r=!0,o.p&&(o.p=o.p.n=void 0),delete r[o.i];e._f=e._l=void 0,e[v]=0},delete:function(e){var r=p(this,t),o=g(r,e);if(o){var n=o.n,s=o.p;delete r._i[o.i],o.r=!0,s&&(s.n=n),n&&(n.p=s),r._f==o&&(r._f=n),r._l==o&&(r._l=s),r[v]--}return!!o},forEach:function(e){p(this,t);for(var r,o=i(e,arguments.length>1?arguments[1]:void 0,3);r=r?r.n:this._f;)for(o(r.v,r.k,this);r&&r.r;)r=r.p},has:function(e){return!!g(p(this,t),e)}}),h&&o(l.prototype,"size",{get:function(){return p(this,t)[v]}}),l},def:function(e,t,r){var o,n,s=g(e,t);return s?s.v=r:(e._l=s={i:n=f(t,!0),k:t,v:r,p:o=e._l,n:void 0,r:!1},e._f||(e._f=s),o&&(o.n=s),e[v]++,"F"!==n&&(e._i[n]=s)),e},getEntry:g,setStrong:function(e,t,r){d(e,t,function(e,r){this._t=p(e,t),this._k=r,this._l=void 0},function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?l(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,l(1))},r?"entries":"values",!r,!0),u(t)}}}});