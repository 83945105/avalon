webpackJsonp([17,25],{"0Eir":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r("qSEq"),o=r("3TTE"),a=r("13vy"),i=r("ELdc"),n={likeText:""},l={name:"resource-tree",mixins:[s.b,o.a],props:{moduleId:{type:String,required:!0},queryParams:Object,queryChildParams:Object},data:function(){return{params:Object(i.a)({},n),treeAsyncProps:{label:"name",isLeaf:"leaf",children:"children",disabled:"disabled"},treeAsyncNodeKey:"id"}},methods:{append:function(e,t){if(t){e=this.formatterTreeAsyncRow(e,{formatterRow:function(e){return e.expanded=!1},formatterNodeIsLeaf:function(e){return 0===e.childCount}});var r=this.$refs[this.treeAsyncRef];r.append(e,r.getNode(t))}},insertAfterRoot:function(e){e=this.formatterTreeAsyncRow(e,{formatterRow:function(e){return e.expanded=!1},formatterNodeIsLeaf:function(e){return 0===e.childCount}});var t=this.$refs[this.treeAsyncRef];t.insertAfter(e,t.getNode(this.treeAsyncRows[this.treeAsyncRows.length-1]))},getCheckedNodes:function(e,t){return this.$refs[this.treeAsyncRef].getCheckedNodes(e,t)},getCheckedKeys:function(e){return this.$refs[this.treeAsyncRef].getCheckedKeys(e)},getTreeAsyncRows:function(){var e=this;this.$emit("check",{},{checkedNodes:[],checkedKeys:[],halfCheckedKeys:[],halfCheckedNodes:[]},this),this.treeAsyncLoading=!0;var t=Object(i.a)({moduleId:this.moduleId},this.params);this.queryParams&&Object(i.a)(t,this.queryParams),this.$Ajax.get(a.a.get.listRootResource,t).success(!0,function(t){e.treeAsyncSkeleton=!1,e.$nextTick(function(){e.treeAsyncRows=e.formatterTreeAsyncRows(t.rows,{formatterRow:function(e){return e.expanded=!1},formatterNodeIsLeaf:function(e){return 0===e.childCount}})})}).notSuccess(function(){return e.treeAsyncSkeleton=500}).catch(function(){return e.treeAsyncSkeleton=500}).finally(function(){return e.treeAsyncLoading=!1})},getTreeAsyncNodes:function(e,t){var r=this,s={moduleId:this.moduleId};this.queryChildParams&&Object(i.a)(s,this.queryChildParams),e.level>=1&&this.$Ajax.get(a.a.get.listResourceByParentId,[e.data.id],{params:s}).success(!0,function(e){var s=r.formatterTreeAsyncRows(e.rows,{formatterRow:function(e){return e.expanded=!1},formatterNodeIsLeaf:function(e){return 0===e.childCount}});t(s)})},handleCheckTreeAsyncNode:function(e,t){this.$emit("check",e,t,this)},handleDblClickTreeAsyncNode:function(e){var t=e.node;e.data.childCount>0&&(t.expanded?t.collapse():t.expand())}},created:function(){this.getTreeAsyncRows()}},c={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",[r("el-input",{staticStyle:{width:"200px"},attrs:{size:"small",clearable:"",placeholder:"请输入内容","prefix-icon":"el-icon-search"},model:{value:e.params.likeText,callback:function(t){e.$set(e.params,"likeText",t)},expression:"params.likeText"}}),e._v(" "),r("span",{staticClass:"btn-p-left"},[r("el-button",{attrs:{type:"success",size:"small",loading:e.treeAsyncLoading},on:{click:e.getTreeAsyncRows}},[e._v("根节点搜索")])],1)],1),e._v(" "),r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.treeAsyncLoading&&!1===e.treeAsyncSkeleton,expression:"treeAsyncLoading && treeAsyncSkeleton === false"}],staticClass:"tree-module-default text-selection",staticStyle:{width:"480px","margin-top":"5px"}},[r("el-autocomplete",{staticStyle:{width:"50%"},attrs:{disabled:"",size:"small",placeholder:"定位资源",debounce:1e3,"value-key":"locationName","prefix-icon":"el-icon-search"}}),e._v(" "),r("we-skeleton",{attrs:{animation:"","paragraph-rows":8},on:{reload:e.getTreeAsyncRows},model:{value:e.treeAsyncSkeleton,callback:function(t){e.treeAsyncSkeleton=t},expression:"treeAsyncSkeleton"}},[r("el-tree",{ref:e.treeAsyncRef,attrs:{data:e.treeAsyncRows,props:e.treeAsyncProps,"node-key":e.treeAsyncNodeKey,lazy:!0,load:e.getTreeAsyncNodes,"expand-on-click-node":!1,"check-strictly":!0,"show-checkbox":"","empty-text":"暂无资源","highlight-current":""},on:{check:e.handleCheckTreeAsyncNode},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.node,o=t.data;return r("span",{},[s.expanded||o.type!==e.dict.resourceTypeValue.NODE?s.expanded&&o.type===e.dict.resourceTypeValue.NODE?r("i",{staticClass:"we-icon-folder-open-o"}):o.type===e.dict.resourceTypeValue.URL?r("i",{staticClass:"we-icon-link"}):o.type===e.dict.resourceTypeValue.PERMISSION?r("i",{staticClass:"we-icon-jurisdiction-shield"}):e._e():r("i",{staticClass:"we-icon-folder-o"}),e._v(" "),r("span",{on:{dblclick:function(t){e.handleDblClickTreeAsyncNode({node:s,data:o})}}},[e._v(e._s(s.label))])])}}])})],1)],1)])},staticRenderFns:[]};var d=r("C7Lr")(l,c,!1,function(e){r("BZEc")},"data-v-2c5673fc",null);t.default=d.exports},"13vy":function(e,t,r){"use strict";var s=r("Nj3f"),o={get:{listResource:s.a+"/api-gar-resource/get/list/resource",pageListResource:s.a+"/api-gar-resource/get/pageList/resource",listRootResource:s.a+"/api-gar-resource/get/list/rootResource",pageListRootResource:s.a+"/api-gar-resource/get/pageList/rootResource",listResourceByParentId:s.a+"/api-gar-resource/get/list/resourceByParentId/{parentId}",listResourceIdAndNameByResourceIds:s.a+"/api-gar-resource/get/list/resourceIdAndNameByResourceIds/{resourceIds}"},post:{resource:s.a+"/api-gar-resource/post/resource"},put:{resourceByResourceId:s.a+"/api-gar-resource/put/resourceByResourceId/{resourceId}"},delete:{resourceByResourceId:s.a+"/api-gar-resource/delete/resourceByResourceId/{resourceId}",listResourceByResourceIds:s.a+"/api-gar-resource/delete/list/resourceByResourceIds/{resourceIds}"}};t.a=o},"3TTE":function(e,t,r){"use strict";t.a={data:function(){return{treeAsyncProps:{label:"name",isLeaf:"leaf",children:"children",disabled:"disabled"},treeAsyncNodeKey:"id",treeAsyncRef:"treeAsync",treeAsyncSkeleton:!0,treeAsyncLoading:!1,treeAsyncRows:[],treeAsyncNodeDeleteLoading$:"delete_loading$",treeAsyncShowAdd:!1,treeAsyncAddLoading:!1,treeAsyncShowEdit:!1,treeAsyncEditLoading:!1,treeAsyncSelectedNode:{},treeAsyncSelectedNodeData:{},treeAsyncAutoExpandKeys:[]}},methods:{formatterTreeAsyncRow:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.formatterRow,s=t.formatterNodeIsLeaf,o=t.formatterNodeChildren;return e[this.treeAsyncNodeDeleteLoading$]=!1,r&&r(e),e[this.treeAsyncProps.isLeaf]=!s||s(e),e[this.treeAsyncProps.children]=o?o(e):[],e},formatterTreeAsyncRows:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=r.formatterRow,o=r.formatterNodeIsLeaf;return e.forEach(function(e){return t.formatterTreeAsyncRow(e,{formatterRow:s,formatterNodeIsLeaf:o})}),e},findRow:function(e,t){if(e&&0!==e.length&&t){var r=void 0;for(var s in e){if(""+e[s][this.treeAsyncNodeKey]==""+t)return e[s];if(r=this.findRow(e[s][this.treeAsyncProps.children],t))return r}}},isTreeAsyncRowHasChildren:function(e){return e[this.treeAsyncProps.children]&&e[this.treeAsyncProps.children].length>0},setTreeAsyncRowChildren:function(e,t){t&&(e[this.treeAsyncProps.children]=t)},addTreeAsyncRowChild:function(e,t){t&&(e[this.treeAsyncProps.children]||this.$set(e,this.treeAsyncProps.children,[]),e[this.treeAsyncProps.children].push(t))},expandTreeNodeByKeys:function(e){var t=e.key;this.$refs[this.treeAsyncRef].store.nodesMap[t].expand()}}}},BZEc:function(e,t){},Eaeu:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r("qSEq"),o=r("ELdc"),a=r("px6D"),i=r("13vy"),n={name:"",type:"",url:"",path:"",description:"",permission:"",status:""},l={name:"resource-add",components:{ResourceTree:r("0Eir").default},mixins:[s.b],props:{moduleId:{type:String,required:!0}},data:function(){return{formLoading:!1,formData:Object(o.a)({},n,{type:s.a.dict.resourceTypeValue.URL,status:s.a.dict.statusValue.NORMAL}),formRules:{name:[{required:!0,message:"请输入资源名称",trigger:"blur"},{min:2,max:64,message:"长度在 2 到 64 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择资源类型",trigger:"change"}],url:[{required:!0,message:"请输入资源地址",trigger:"blur"}],permission:[{required:!0,message:"请输入资源许可",trigger:"blur"}]},roleList:[],roleLoading:!1,roleIds:[],isIndeterminateRoles:!1,isCheckAllRoles:!1}},methods:{getRoleList:function(){var e=this;this.roleLoading=!0,this.$Ajax.get(a.a.get.listRole,{moduleId:this.moduleId}).success(!0,function(t){e.roleList=t.rows}).finally(function(){return e.roleLoading=!1})},handleCheckAllRoles:function(e){this.isIndeterminateRoles=!1,this.roleIds=e?this.roleList.map(function(e){return e.id}):[]},handleCheckRoles:function(e){var t=e.length;this.isCheckAllRoles=t===this.roleList.length,this.isIndeterminateRoles=t>0&&t<this.roleList.length},submit:function(){var e=this;this.$refs.form.validate(function(t){if(t){e.formLoading=!0;var r=Object(o.a)({moduleId:e.moduleId},e.formData);e.roleIds.length>0&&(r.roleIdSet=e.roleIds.toString());var s=e.$refs.resourceTree.getCheckedKeys();s.length>0&&(r.parentIdSet=s.toString()),e.$Ajax.post(i.a.post.resource,r).success("新建资源成功",function(t){var r=t.rows;r&&r.length>0&&r.forEach(function(t){if(t.type!==e.dict.resourceTypeValue.NODE)return!0;t.parentId?e.$refs.resourceTree.append(t,t.parentId):e.$refs.resourceTree.insertAfterRoot(t)}),e.$emit("submit-success",t,e)}).finally(function(){return e.formLoading=!1})}})}},created:function(){this.getRoleList()}},c={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.formLoading,expression:"formLoading"}],ref:"form",staticStyle:{margin:"30px 30px 30px 30px"},attrs:{model:e.formData,rules:e.formRules,"label-width":"80px"}},[r("el-form-item",{attrs:{label:"资源名称",prop:"name"}},[r("el-input",{attrs:{placeholder:"请输入资源名称",size:"small"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"资源类型",prop:"type"}},[r("el-select",{attrs:{placeholder:"请选择资源类型",size:"small"},model:{value:e.formData.type,callback:function(t){e.$set(e.formData,"type",t)},expression:"formData.type"}},e._l(e.dict.resourceTypes,function(t,s){return r("el-option",{key:s,attrs:{label:t.label,title:t.value,value:t.value}},[t.value===e.dict.resourceTypeValue.NODE?r("i",{staticClass:"we-icon-folder-o"}):t.value===e.dict.resourceTypeValue.URL?r("i",{staticClass:"we-icon-link"}):t.value===e.dict.resourceTypeValue.PERMISSION?r("i",{staticClass:"we-icon-jurisdiction-shield"}):e._e(),e._v(" "),r("span",[e._v(e._s(t.label))])])}),1)],1),e._v(" "),e.formData.type===e.dict.resourceTypeValue.URL?r("el-form-item",{attrs:{label:"资源地址",prop:"url"}},[r("el-input",{attrs:{placeholder:"请输入资源请求地址URL(相对路径,不包含项目根路径,以 / 开头)",size:"small"},model:{value:e.formData.url,callback:function(t){e.$set(e.formData,"url",t)},expression:"formData.url"}})],1):e._e(),e._v(" "),e.formData.type===e.dict.resourceTypeValue.PERMISSION?r("el-form-item",{attrs:{label:"资源许可",prop:"permission"}},[r("el-input",{attrs:{placeholder:"请输入资源许可(用于Shiro注解)",size:"small"},model:{value:e.formData.permission,callback:function(t){e.$set(e.formData,"permission",t)},expression:"formData.permission"}})],1):e._e(),e._v(" "),r("el-form-item",{attrs:{label:"资源描述",prop:"description"}},[r("el-input",{attrs:{type:"textarea",autosize:"",placeholder:"请输入资源描述",size:"small"},model:{value:e.formData.description,callback:function(t){e.$set(e.formData,"description",t)},expression:"formData.description"}})],1),e._v(" "),e.formData.type!==e.dict.resourceTypeValue.NODE?r("el-form-item",{attrs:{label:"立即使用",prop:"status"}},[r("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#cccccc","active-value":e.dict.statusValue.NORMAL,"inactive-value":e.dict.statusValue.DISABLED},model:{value:e.formData.status,callback:function(t){e.$set(e.formData,"status",t)},expression:"formData.status"}})],1):e._e(),e._v(" "),e.formData.type!==e.dict.resourceTypeValue.NODE?r("el-form-item",{directives:[{name:"loading",rawName:"v-loading",value:e.roleLoading,expression:"roleLoading"}],attrs:{label:"选择角色",prop:"roleIds"}},[r("el-checkbox",{attrs:{indeterminate:e.isIndeterminateRoles},on:{change:e.handleCheckAllRoles},model:{value:e.isCheckAllRoles,callback:function(t){e.isCheckAllRoles=t},expression:"isCheckAllRoles"}},[e._v("全选\n    ")]),e._v(" "),r("el-checkbox-group",{attrs:{size:"small"},on:{change:e.handleCheckRoles},model:{value:e.roleIds,callback:function(t){e.roleIds=t},expression:"roleIds"}},[r("ul",{staticClass:"button-list"},e._l(e.roleList,function(t){return r("li",[r("el-checkbox",{attrs:{label:t.id,title:t.value,disabled:t.status===e.dict.statusValue.DISABLED,border:""}},[e._v(e._s(t.name)+"\n          ")])],1)}),0)])],1):e._e(),e._v(" "),r("el-form-item",{attrs:{label:"所属节点",prop:"roles"}},[r("resource-tree",{ref:"resourceTree",attrs:{"module-id":e.moduleId,"query-params":{typeSet:e.dict.resourceTypeValue.NODE,childTypeSet:e.dict.resourceTypeValue.NODE},"query-child-params":{typeSet:e.dict.resourceTypeValue.NODE,childTypeSet:e.dict.resourceTypeValue.NODE}}})],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{loading:e.formLoading,type:"primary"},on:{click:e.submit}},[e._v("立即创建")]),e._v(" "),r("el-button",{attrs:{disabled:e.formLoading},on:{click:function(t){e.$refs.form.resetFields()}}},[e._v("重置")])],1)],1)},staticRenderFns:[]};var d=r("C7Lr")(l,c,!1,function(e){r("N3y+")},"data-v-d1956a5c",null);t.default=d.exports},"N3y+":function(e,t){},px6D:function(e,t,r){"use strict";var s=r("Nj3f"),o={get:{validateValueCanUse:s.a+"/api-gar-role/get/validateValueCanUse/{value}",pageListRole:s.a+"/api-gar-role/get/pageList/role",listRole:s.a+"/api-gar-role/get/list/role"},post:{role:s.a+"/api-gar-role/post/role"},put:{roleByRoleId:s.a+"/api-gar-role/put/roleByRoleId/{roleId}"},delete:{roleByRoleId:s.a+"/api-gar-role/delete/roleByRoleId/{roleId}",listRoleByRoleIds:s.a+"/api-gar-role/delete/list/roleByRoleIds/{roleIds}"}};t.a=o}});